function barViz(t,e,a,r){if("days"===r)var n=[startDate,endDate],i=30;else if("months"===r){var n=[startDate,endDate],i=d3.time.months(startDate,endDate).length;width=13*i}else var n=[startTime,endTime],i=24;var l=d3.time.scale.utc().domain(n).rangeRound([0,width]),o=d3.scale.linear().domain([0,d3.max(t,function(t){return t.values[a]})]).rangeRound([height,0]),s=d3.svg.axis().scale(l).tickSize(0).ticks(0),d=d3.select(e).append("svg").data([t]).attr("width",margin.left+width+margin.right).attr("height",margin.top+height+margin.bottom).attr("class","chart barchart").append("svg:g").attr("transform","translate("+margin.left+","+margin.top+")"),u=null;d.selectAll(".bar").data(t).enter().append("rect").attr("class",function(t){if("days"===r){u=Date.parse(t.key+"T12:00:00Z");return formatWeek(new Date(u))%2==0?"bar relations":"bar relations-alt"}if("months"===r){u=Date.parse(t.key+"-01T12:00:00Z");return formatYear(new Date(u))%2==0?"bar relations":"bar relations-alt"}u=Date.parse(t.key+":00:01Z");var e=formatHour(new Date(u));return e>=11&&e<=22?"bar relations-alt":"bar relations"}).attr("x",function(t){return l("days"===r?new Date(Date.parse(t.key+"T12:00:00Z")):"months"===r?new Date(Date.parse(t.key+"-01T12:00:00Z")):new Date(Date.parse(t.key+":00:00Z")))}).attr("width",width/i-1).attr("y",function(t){return o(t.values[a])}).attr("height",function(t){return height-o(t.values[a])});return d.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(s),d.selectAll("rect").each(function(t){var e=null,n=null,i=null;e="db_size"===a?numberToHumanSize(t.values[a]):"requests_average"===a?formatFixed(t.values[a])+" ms":formatFixed(t.values[a]),"days"===r?(n=Date.parse(t.key+"T12:00:00Z"),i=" on "+formatDate(new Date(n))):"months"===r?(n=Date.parse(t.key+"-01T12:00:00Z"),i=" in "+formatMonthYear(new Date(n))):(n=Date.parse(t.key+":00:00Z"),i=" at "+formatTime(new Date(n))),$(this).tooltip({title:e+i,container:"body"})}),d3.select(e+"-loading").remove(),d}function hBarViz(t,e){if(void 0===t)return void d3.select("#"+e+"-loading").remove();var a=d3.select("div#"+e+"-body").append("svg").attr("width",w+l+r).attr("height",t.length*(h+2*s)+30).attr("class","chart").append("g").attr("transform","translate("+l+","+h+")"),n=null;n="work"===e?d3.scale.linear().domain([0,d3.max(t,function(t){return t[e+"_count"]})]).range([0,w]):d3.scale.log().domain([.1,d3.max(t,function(t){return t[e+"_count"]})]).range([1,w]);var i=d3.scale.ordinal().domain(t.map(function(t){return t.title})).rangeBands([0,(h+2*s)*t.length]),o=d3.scale.ordinal().domain(t.map(function(t){return t.group_id})).range(colors);a.selectAll("text.labels").data(t).enter().append("a").attr("xlink:href",function(t){return"/sources/"+t.id}).append("text").attr("x",0).attr("y",function(t){return i(t.title)+i.rangeBand()/2}).attr("dx",0-l).attr("dy",".18em").text(function(t){return t.title}),a.selectAll("rect").data(t).enter().append("rect").attr("fill",function(t){return o(t.group_id)}).attr("y",function(t){return i(t.title)}).attr("height",h).attr("width",function(t){return n(t[e+"_count"])}),a.selectAll("text.values").data(t).enter().append("text").attr("x",function(t){return n(t[e+"_count"])}).attr("y",function(t){return i(t.title)+i.rangeBand()/2}).attr("dx",5).attr("dy",".18em").text(function(t){return numberWithDelimiter(t[e+"_count"])}),d3.select("#"+e+"-loading").remove()}var width=240,height=100,margin={top:7,right:10,bottom:5,left:5},colors=["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#95a6a6"],l=250,r=150,w=400,h=24,s=2;